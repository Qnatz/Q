<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDE Server GUI</title>
</head>
<body>
    <h1>IDE Server GUI</h1>

    <h2>Server Status</h2>
    <p id="status">Unknown</p>

    <h2>Code Input</h2>
    <textarea id="code-input" rows="10" cols="80"></textarea>
    <br>
    <button id="assist-button">Code Assist</button>
    <button id="review-button">Review</button>
    <button id="qa-button">QA</button>

    <h2>Output</h2>
    <pre id="output"></pre>

    <script>
        const statusElement = document.getElementById('status');
        const codeInputElement = document.getElementById('code-input');
        const assistButtonElement = document.getElementById('assist-button');
        const reviewButtonElement = document.getElementById('review-button');
        const qaButtonElement = document.getElementById('qa-button');
        const outputElement = document.getElementById('output');

        // Check server status
        fetch('http://127.0.0.1:8001/')
            .then(response => response.json())
            .then(data => {
                statusElement.textContent = data.status;
            })
            .catch(error => {
                statusElement.textContent = 'Error connecting to server.';
                console.error('Error:', error);
            });

        // --- Event Listeners for Buttons ---

        assistButtonElement.addEventListener('click', () => {
            const code = codeInputElement.value;
            postToServer('/assist', { code });
        });

        reviewButtonElement.addEventListener('click', () => {
            const code = codeInputElement.value;
            postToServer('/review', { code });
        });

        qaButtonElement.addEventListener('click', () => {
            const code = codeInputElement.value;
            postToServer('/qa', { code });
        });

        // --- Helper Function to Post to Server ---

        function postToServer(endpoint, data) {
            outputElement.textContent = 'Loading...';
            fetch(`http://127.0.0.1:8001${endpoint}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(result => {
                // The response from the server is a JSON object.
                // We need to extract the relevant field (assistance, review, or qa)
                // and then display it as a formatted JSON string.
                let output = "Could not find relevant output.";
                if (result.assistance) {
                    output = result.assistance;
                } else if (result.review) {
                    output = result.review;
                } else if (result.qa) {
                    output = result.qa;
                }

                try {
                    // Try to parse the output if it's a JSON string
                    const parsedOutput = JSON.parse(output);
                    outputElement.textContent = JSON.stringify(parsedOutput, null, 2);
                } catch (e) {
                    // If it's not a JSON string, display it as is
                    outputElement.textContent = output;
                }
            })
            .catch((error) => {
                outputElement.textContent = `Error: ${error.message}`;
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>